
/// Creating

/// phpdevorg.cprop

the module `phpdevorg.cprop` lacks documentations and is no longer supported by the devs but kind ppl still exist on the internet <3

USEFUL COMMENT FROM A USER ON THE MODULE phpdevorg.cprop
	Модуль хороший, жаль перестали поддерживать.
	`Чтобы заработало под PHP 8`, нужно в файле /bitrix/modules/phpdevorg.cprop/lib/CIBlockPropertyCProp.php изменить несколько строк.
	1. Строка 26 "public function GetPropertyFieldHtml($arProperty, $value, $strHTMLControlName)" заменить на "public static function GetPropertyFieldHtml($arProperty, $value, $strHTMLControlName)"
	2. Строка 205 "public function ConvertToDB($arProperty, $arValue)" заменить на "public static function ConvertToDB($arProperty, $arValue)".
	3. Строка 235 "public function ConvertFromDB($arProperty, $arValue)" заменить на "public static function ConvertFromDB($arProperty, $arValue)".
	\\ ANOTHER USER ALSO SAID TO CHANGE FUNC GetUserTypeDescription TO STATIC TOO
	Чтобы заработал фильтр по getlist или соответствующим компонентам, то нужно делать поиск, как по строке. Допустим у вас в комплексном свойстве есть два подсвойства "prop1", "prop2" и "prop3", и вам нужно найти все элементы, у которых prop2=100. Поскольку значения в свойстве содержатся в виде строки в JSON формате, то пишем фильтр так.
	$arFilter[] = [
		"LOGIC" => "OR",
		["PROPERTY_COMPLEX" => '%"prop2":"'.$prop2.',"%'],
		["PROPERTY_COMPLEX" => '%"prop2":'.$prop2.',%'],
	];
	Тут добавляем %%, чтобы поиск был по вхождению.
	Logic or нужен по той причине, что иногда эти свойства сохраняются в виде {"prop2": "value2"}, а иногда value без кавычек {"prop2": value2}.
	Также, в конце перед % нужно добавлять запятую, если prop2 добавлено не последним подсвойством, либо фигурную скобку }, если prop2 добавлено последним.

ANOTHER USEFUL COMMENT
	Если у кого то ошибка js в консоли при переходе в настройки свойства, например:
	`"$ is not defined" и поля в настройках не добавляются` то в классе "CIBlockPropertyCProp" нужно изменить метод на 600 строке:
	private static function showJsForSetting($inputName)
	{
		?>
		<script>
			(function () {
				function run() {
					window.addNewRows = function () {
						const html =
							'<tr valign="top">' +
							'<td><input type="text" class="inp-code" size="20"></td>' +
							'<td><input type="text" class="inp-title" size="35"></td>' +
							'<td><input type="text" class="inp-sort" size="5" value="500"></td>' +
							'<td><select class="inp-type"><?=CUtil::JSEscape(self::getOptionList())?></select></td>' +
							'</tr>';
						jQuery("#many-fields-table").append(html);
					};
					jQuery(document).on('change', '.inp-code', function () {
						const code = jQuery(this).val();
						const row = jQuery(this).closest('tr');

						if (code.length <= 0) {
							row.find('input.inp-title').removeAttr('name');
							row.find('input.inp-sort').removeAttr('name');
							row.find('select.inp-type').removeAttr('name');
						} else {
							row.find('input.inp-title').attr('name', '<?=$inputName?>[' + code + '_TITLE]');
							row.find('input.inp-sort').attr('name', '<?=$inputName?>[' + code + '_SORT]');
							row.find('select.inp-type').attr('name', '<?=$inputName?>[' + code + '_TYPE]');
						}
					});

					jQuery(document).on('input', '.inp-sort', function () {
						const num = jQuery(this).val();
						jQuery(this).val(num.replace(/[^0-9]/g, ''));
					});
				}
				if (typeof jQuery === 'undefined') {
					const script = document.createElement('script');
					script.src = 'https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js';
					script.onl ad = run;
					document.head.appendChild(script);
				} else {
					run();
				}
			})();
		</script>
		<?php
	}

`TL;DR: result is` i managed to fix the module so it works in the firstplace and i can see how else i can rewrite it.
i successfully mostly rewrote it :thumbs_up:
~~~~ the second comment is useful but you can just fix the original code by replacing lines `CJSCore::Init(['jquery'])` with `\CJSCore::Init(['jquery3'])`!!!

`notes`:
\\https://dev.1c-bitrix.ru/api_help/iblock/classes/user_properties/GetUserTypeDescription.php
in GetUserTypeDescription() func 
	- `'PROPERTY_TYPE' => 'S'` : S is one of standard types, string.
	- `'USER_TYPE' => 'C'` : unique id for user property. changed it to 'ComplexProperty'.
	- DESCRIPTION : what the property will be called in the list of types.
	- the rest of the fields are optional handlers, class+method arrays.
arProperty = https://dev.1c-bitrix.ru/api_help/iblock/fields.php#fproperty



/// custom html editor field within the complex property

tried to install `d2mg.ufhtml` module to investigate what its html redactor looks like and it brock my site lmao. the site works again after i deleted the module from files, but idk how to fix the module yet. sleep time.
there's another module `solverweb.ufhtml` that's based on the one mentioned above but i can't install it bc i'm using a demo version of bitrix :/ (https://marketplace.1c-bitrix.ru/solutions/solverweb.ufhtml)
another way to add html editor: https://pai-bx.com/wiki/1c-bitrix/2485-adding-a-custom-text-html-field-to-1c-bitrix/

`TL;DR: result is` managed to add html visual redactor:
	- added "elseif (... === 'html') {...}" to GetPropertyFieldHtml
	- added option 'html' to getOptionList and the loc message associated with it
	- wrote showHtmlarea func. uses `CFileMan::AddHTMLEditorFrame` to insert html editor, BUT this method auto removes brackets from the first parameter (the name of html editor) so i first use a placeholder name which i later replace back to the name i need 



/// user fields

С помощью пользовательских полей можно создать новые поля к объектам Bitrix Framework. Например, добавить дополнительные данные к пользователю, задаче, сделке. Для каждого объекта можно создать произвольное количество пользовательских полей. Код пользовательского поля всегда начинается с префикса `UF_`: UF_PHONE, UF_BIRTHDATE, UF_RATING.
Нужно различать два понятия:
	- пользовательские поля — универсальный механизм, который работает с разными объектами системы: пользователями, CRM, задачами, календарями,
	- свойства инфоблоков — применяются только для элементов и разделов инфоблоков.
В формах интерфейса можно встретить название `пользовательские свойства. Оно означает пользовательские поля, а не свойства`.
Создайте пользовательское поле одним из двух способов.
	1. На странице Настройки > Настройки продукта > Пользовательские поля нажмите Добавить.
	2. В форме редактирования объекта, где доступны пользовательские поля, перейдите по ссылке Добавить пользовательское свойство. Например, в форме редактирования пользователя, раздела инфоблока, блога или сущности CRM.
more about user fields: https://docs.1c-bitrix.ru/pages/cms-basics/userfields.html

`useful` how to make custom userfield type: https://goroshcko.ru/razrabotka/1c-bitrix/sozdanie-svoego-tipa-polzovatelskogo-polja-usertype-v-bitriks-d7/

created a new class for complex user field type (extends BaseType). and declared it in include.php and install/index.php
copied a default example of userfield type 'file' from /bitrix/modules/main/lib/userfield/types.
the settings for the field in admin (while creating new userfield) are displayed via `RENDER_COMPONENT` const.
	* Обновленный подход предполагает использование класса пользовательского поля и соответствующего ему компонента, содержащего все необходимые шаблоны. Например, появились связки:
		- main/lib/userfield/types/StringType и main/install/components/bitrix/main.field.string
		- iblock/lib/userfield/types/ElementType и iblock/install/components/bitrix/iblock.field.element
copied main.field.file from /bitrix/modules/main/install/components/bitrix folder to go along with the userfield class example.

i did it :D 
i bashed my head against the wall a lot by i did it :D almost gave up on making the userfield being able to take 'multiple' setting like cprop.
the only notable error in all of this module is that, if one of the fields (in cprop or cfield) is an html editor and it's on 'multiple' setting, the radio buttons don't work properly. but idc. unless someone tells me to care.



____________________________________________

task received:	2026-01-20
task started:	2026-01-17
task finished:	2026-01-19
time elapsed:	7:00 + 8:00 + 8:00 = 23:00
